# rccldev-tools

This repository contains a collection of some frequently used Python/shell scripts or programs to automate tasks

## Introduction

Performance data collection is a repetitive task while working with RCCL to check if there are any drops or improvements

### rccldev-tools/scripts/sweeptest.sh
- This shell script can be used to collect RCCL performance numbers from rccl-tests on a system with ROCm-capable devices (MI series GPUs)

#### Example usage 

```
git clone https://github.com/PJAvinash/rccldev-tools.git

chmod +x ./rccldev-tools/scripts/sweeptest.sh

./rccldev-tools/scripts/sweeptest.sh

```

- This script will run rccl-tests in MPI mode on a single node with 8 GPUs . Please change the script to use the number of GPUs available.  This will be changed to pick the number of available devices on a system (2/4/8 or any number)
- This script clones the rccl repository, changes the branch to mainline, and builds librccl.so, builds MPI (mpich) from source, clones rccl-test, and builds binaries by linking them to librccl.so and MPI in the same temp directory, and finally generates a perfdata_<date(yyyy-MM-dd)> directory with performance data for each datatype in <rccldatatype>.txt files
- The data generation task typically takes 200 minutes on an 8-GPU system ( 20 iterations, 5 warm-up iterations, 10 runs per collective per data type).

### rccldev-tools/scripts/scripts/generateReport.py
- This Python script can be used to consolidate raw (.txt /.log) performance data into .xlsx files as per the agreed format
- pip install (numpy, pandas, plotly, openpyxl) if prompted
  
#### Example usage

To know the HIP/ROCm/RCCL versions 
```
cat perfdata_<yyyy-MM-dd>/all_reduce.txt | grep "version"
```
Now run the Python script
```
python3 ./rccldev-tools/scripts/generateReport.py
```

- This will ask for a directory with .txt files generated by sweeptest.sh (perfdata_<yyyy-MM-dd>). You can provide an output directory for generated Excel files, or the default directory will be used. 
- This will ask for HIP/ ROCm /RCCL versions ( will be changed to parse from files in the future), TransferBench Bandwidth (can be automated in the future), and BKC/IFWI information (cannot be automated).
- These can be any strings, but they will be replaced in specific cells in Excel workbooks with the strings you provide
- The execution should take about 30 seconds, and the data we get is the mean of all the runs for a combination of <data type, data size, and collective name>.

Use scp to move files from remote to local machines for your use.

Feel free to ask for simple enhancements. 



